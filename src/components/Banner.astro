---
interface Props {
  showLogo?: boolean;
}

const { showLogo = false } = Astro.props;
const locale = Astro.currentLocale || 'es';

// Obtener la ruta actual
const currentPath = Astro.url.pathname;

// Detectar si estamos en la página home (considerando prefijos de idioma)
const isHomePage = currentPath === '/' || currentPath.match(/^\/[a-z]{2}\/?$/);

// Determinar el nombre de la ruta
let routeName: string;
if (isHomePage) {
  routeName = 'home';
} else {
  // Extraer el nombre de la ruta removiendo el prefijo de idioma si existe
  const pathWithoutLocale = currentPath.replace(/^\/[a-z]{2}\//, '/').replace(/^\/+|\/+$/g, '');
  routeName = pathWithoutLocale.split('/')[0] || 'home';
}

// Construir las rutas de las imágenes basándose en la ruta y locale
let mobileImage: string;
let desktopImage: string;

if (isHomePage) {
  // Para la página home, usar el patrón original
  mobileImage = `/images/banner-home-mobile.webp`;
  desktopImage = `/images/banner-home-desktop.webp`;
} else {
  // Para otras rutas, usar el nuevo patrón
  mobileImage = `/images/banner-${routeName}-mobile-${locale}.webp`;
  desktopImage = `/images/banner-${routeName}-desktop-${locale}.webp`;
}

const logoImage = "/images/logo-jamcam-white.svg";
---

<section class="banner-container w-full relative overflow-hidden">
  <!-- Imagen de fondo responsive con optimizaciones de rendimiento -->
  <picture class="banner-picture">
    <!-- Desktop -->
    <source 
      media="(min-width: 1024px)" 
      srcset={desktopImage}
      type="image/webp"
    />
    <!-- Mobile -->
    <img 
      src={mobileImage}
      alt="Banner JamCam 2025"
      class="banner-image"
      loading="eager"
      fetchpriority="high"
      decoding="sync"
      width="768"
      height="432"
    />
  </picture>

  <!-- Logo opcional centrado -->
  {showLogo && (
    <div class="logo-overlay">
      <img 
        src={logoImage}
        alt="Logo JamCam 2025"
        class="logo-image"
        loading="lazy"
        decoding="async"
        width="280"
        height="320"
      />
    </div>
  )}
</section>

<style>
  .banner-container {
    /* Prevent layout shift by setting minimum height */
    min-height: 250px; /* Mobile */
    contain: layout style paint;
  }

  .banner-picture {
    display: block;
    width: 100%;
  }

  .banner-image {
    width: 100%;
    height: auto;
    object-fit: contain;
    /* Optimize rendering */
    will-change: auto;
    transform: translateZ(0); /* Force GPU acceleration */
  }

  .logo-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    z-index: 10;
    padding-top: 20vh;
  }

  .logo-image {
    height: 280px;
    width: auto;
    object-fit: contain;
    transform: translateZ(0); /* Force GPU acceleration */
  }

  @media (min-width: 1024px) {
    .banner-container {
      min-height: 400px; /* Desktop */
    }

    .logo-overlay {
      padding-top: 15vh;
    }

    .logo-image {
      height: 320px;
    }
  }

  /* Optimize for faster repaints */
  @media (hover: hover) {
    .banner-image:hover {
      transform: translateZ(0);
    }
  }
</style>