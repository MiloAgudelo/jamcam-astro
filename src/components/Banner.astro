---
import { Image } from 'astro:assets';

// Import all banner images
import bannerHomeDesktop from '../assets/images/banner/banner-home-desktop.webp';
import bannerHomeMobile from '../assets/images/banner/banner-home-mobile.webp';

// Home invitation images
import bannerHomeInvitationDesktopEs from '../assets/images/banner/banner-home-invitation-desktop-es.webp';
import bannerHomeInvitationDesktopEn from '../assets/images/banner/banner-home-invitation-desktop-en.webp';
import bannerHomeInvitationDesktopPt from '../assets/images/banner/banner-home-invitation-desktop-pt.webp';
import bannerHomeInvitationDesktopFr from '../assets/images/banner/banner-home-invitation-desktop-fr.webp';
import bannerHomeInvitationMobileEs from '../assets/images/banner/banner-home-invitation-mobile-es.webp';
import bannerHomeInvitationMobileEn from '../assets/images/banner/banner-home-invitation-mobile-en.webp';
import bannerHomeInvitationMobilePt from '../assets/images/banner/banner-home-invitation-mobile-pt.webp';
import bannerHomeInvitationMobileFr from '../assets/images/banner/banner-home-invitation-mobile-fr.webp';

// About page images
import bannerAboutDesktopEs from '../assets/images/banner/banner-about-desktop-es.webp';
import bannerAboutDesktopEn from '../assets/images/banner/banner-about-desktop-en.webp';
import bannerAboutDesktopPt from '../assets/images/banner/banner-about-desktop-pt.webp';
import bannerAboutDesktopFr from '../assets/images/banner/banner-about-desktop-fr.webp';
import bannerAboutMobileEs from '../assets/images/banner/banner-about-mobile-es.webp';
import bannerAboutMobileEn from '../assets/images/banner/banner-about-mobile-en.webp';
import bannerAboutMobilePt from '../assets/images/banner/banner-about-mobile-pt.webp';
import bannerAboutMobileFr from '../assets/images/banner/banner-about-mobile-fr.webp';

// Cali page images
import bannerCaliDesktopEs from '../assets/images/banner/banner-cali-desktop-es.webp';
import bannerCaliDesktopEn from '../assets/images/banner/banner-cali-desktop-en.webp';
import bannerCaliDesktopPt from '../assets/images/banner/banner-cali-desktop-pt.webp';
import bannerCaliDesktopFr from '../assets/images/banner/banner-cali-desktop-fr.webp';
import bannerCaliMobileEs from '../assets/images/banner/banner-cali-mobile-es.webp';
import bannerCaliMobileEn from '../assets/images/banner/banner-cali-mobile-en.webp';
import bannerCaliMobilePt from '../assets/images/banner/banner-cali-mobile-pt.webp';
import bannerCaliMobileFr from '../assets/images/banner/banner-cali-mobile-fr.webp';

// Contacts page images
import bannerContactsDesktopEs from '../assets/images/banner/banner-contacts-desktop-es.webp';
import bannerContactsDesktopEn from '../assets/images/banner/banner-contacts-desktop-en.webp';
import bannerContactsDesktopPt from '../assets/images/banner/banner-contacts-desktop-pt.webp';
import bannerContactsDesktopFr from '../assets/images/banner/banner-contacts-desktop-fr.webp';
import bannerContactsMobileEs from '../assets/images/banner/banner-contacts-mobile-es.webp';
import bannerContactsMobileEn from '../assets/images/banner/banner-contacts-mobile-en.webp';
import bannerContactsMobilePt from '../assets/images/banner/banner-contacts-mobile-pt.webp';
import bannerContactsMobileFr from '../assets/images/banner/banner-contacts-mobile-fr.webp';

// Participate page images
import bannerParticipateDesktopEs from '../assets/images/banner/banner-participate-desktop-es.webp';
import bannerParticipateDesktopEn from '../assets/images/banner/banner-participate-desktop-en.webp';
import bannerParticipateDesktopPt from '../assets/images/banner/banner-participate-desktop-pt.webp';
import bannerParticipateDesktopFr from '../assets/images/banner/banner-participate-desktop-fr.webp';
import bannerParticipateMobileEs from '../assets/images/banner/banner-participate-mobile-es.webp';
import bannerParticipateMobileEn from '../assets/images/banner/banner-participate-mobile-en.webp';
import bannerParticipateMobilePt from '../assets/images/banner/banner-participate-mobile-pt.webp';
import bannerParticipateMobileFr from '../assets/images/banner/banner-participate-mobile-fr.webp';

// Program page images
import bannerProgramDesktopEs from '../assets/images/banner/banner-program-desktop-es.webp';
import bannerProgramDesktopEn from '../assets/images/banner/banner-program-desktop-en.webp';
import bannerProgramDesktopPt from '../assets/images/banner/banner-program-desktop-pt.webp';
import bannerProgramDesktopFr from '../assets/images/banner/banner-program-desktop-fr.webp';
import bannerProgramMobileEs from '../assets/images/banner/banner-program-mobile-es.webp';
import bannerProgramMobileEn from '../assets/images/banner/banner-program-mobile-en.webp';
import bannerProgramMobilePt from '../assets/images/banner/banner-program-mobile-pt.webp';
import bannerProgramMobileFr from '../assets/images/banner/banner-program-mobile-fr.webp';

// Resources page images
import bannerResourcesDesktopEs from '../assets/images/banner/banner-resources-desktop-es.webp';
import bannerResourcesDesktopEn from '../assets/images/banner/banner-resources-desktop-en.webp';
import bannerResourcesDesktopPt from '../assets/images/banner/banner-resources-desktop-pt.webp';
import bannerResourcesDesktopFr from '../assets/images/banner/banner-resources-desktop-fr.webp';
import bannerResourcesMobileEs from '../assets/images/banner/banner-resources-mobile-es.webp';
import bannerResourcesMobileEn from '../assets/images/banner/banner-resources-mobile-en.webp';
import bannerResourcesMobilePt from '../assets/images/banner/banner-resources-mobile-pt.webp';
import bannerResourcesMobileFr from '../assets/images/banner/banner-resources-mobile-fr.webp';

// Service team page images
import bannerServiceTeamDesktopEs from '../assets/images/banner/banner-service-team-desktop-es.webp';
import bannerServiceTeamDesktopEn from '../assets/images/banner/banner-service-team-desktop-en.webp';
import bannerServiceTeamDesktopPt from '../assets/images/banner/banner-service-team-desktop-pt.webp';
import bannerServiceTeamDesktopFr from '../assets/images/banner/banner-service-team-desktop-fr.webp';
import bannerServiceTeamMobileEs from '../assets/images/banner/banner-service-team-mobile-es.webp';
import bannerServiceTeamMobileEn from '../assets/images/banner/banner-service-team-mobile-en.webp';
import bannerServiceTeamMobilePt from '../assets/images/banner/banner-service-team-mobile-pt.webp';
import bannerServiceTeamMobileFr from '../assets/images/banner/banner-service-team-mobile-fr.webp';

interface Props {
  showLogo?: boolean;
}

const { showLogo = false } = Astro.props;
const locale = Astro.currentLocale || 'es';

// Obtener la ruta actual
const currentPath = Astro.url.pathname;

// Detectar si estamos en la página home (considerando prefijos de idioma)
const isHomePage = currentPath === '/' || currentPath.match(/^\/[a-z]{2}\/?$/);

// Determinar el nombre de la ruta
let routeName: string;
if (isHomePage) {
  routeName = 'home';
} else {
  // Extraer el nombre de la ruta removiendo el prefijo de idioma si existe
  const pathWithoutLocale = currentPath.replace(/^\/[a-z]{2}\//, '/').replace(/^\/+|\/+$/g, '');
  routeName = pathWithoutLocale.split('/')[0] || 'home';
}

// Create image maps for easy access
const bannerImages = {
  home: {
    desktop: bannerHomeDesktop,
    mobile: bannerHomeMobile,
    invitation: {
      desktop: {
        es: bannerHomeInvitationDesktopEs,
        en: bannerHomeInvitationDesktopEn,
        pt: bannerHomeInvitationDesktopPt,
        fr: bannerHomeInvitationDesktopFr,
      },
      mobile: {
        es: bannerHomeInvitationMobileEs,
        en: bannerHomeInvitationMobileEn,
        pt: bannerHomeInvitationMobilePt,
        fr: bannerHomeInvitationMobileFr,
      }
    }
  },
  about: {
    desktop: {
      es: bannerAboutDesktopEs,
      en: bannerAboutDesktopEn,
      pt: bannerAboutDesktopPt,
      fr: bannerAboutDesktopFr,
    },
    mobile: {
      es: bannerAboutMobileEs,
      en: bannerAboutMobileEn,
      pt: bannerAboutMobilePt,
      fr: bannerAboutMobileFr,
    }
  },
  cali: {
    desktop: {
      es: bannerCaliDesktopEs,
      en: bannerCaliDesktopEn,
      pt: bannerCaliDesktopPt,
      fr: bannerCaliDesktopFr,
    },
    mobile: {
      es: bannerCaliMobileEs,
      en: bannerCaliMobileEn,
      pt: bannerCaliMobilePt,
      fr: bannerCaliMobileFr,
    }
  },
  contacts: {
    desktop: {
      es: bannerContactsDesktopEs,
      en: bannerContactsDesktopEn,
      pt: bannerContactsDesktopPt,
      fr: bannerContactsDesktopFr,
    },
    mobile: {
      es: bannerContactsMobileEs,
      en: bannerContactsMobileEn,
      pt: bannerContactsMobilePt,
      fr: bannerContactsMobileFr,
    }
  },
  participate: {
    desktop: {
      es: bannerParticipateDesktopEs,
      en: bannerParticipateDesktopEn,
      pt: bannerParticipateDesktopPt,
      fr: bannerParticipateDesktopFr,
    },
    mobile: {
      es: bannerParticipateMobileEs,
      en: bannerParticipateMobileEn,
      pt: bannerParticipateMobilePt,
      fr: bannerParticipateMobileFr,
    }
  },
  program: {
    desktop: {
      es: bannerProgramDesktopEs,
      en: bannerProgramDesktopEn,
      pt: bannerProgramDesktopPt,
      fr: bannerProgramDesktopFr,
    },
    mobile: {
      es: bannerProgramMobileEs,
      en: bannerProgramMobileEn,
      pt: bannerProgramMobilePt,
      fr: bannerProgramMobileFr,
    }
  },
  resources: {
    desktop: {
      es: bannerResourcesDesktopEs,
      en: bannerResourcesDesktopEn,
      pt: bannerResourcesDesktopPt,
      fr: bannerResourcesDesktopFr,
    },
    mobile: {
      es: bannerResourcesMobileEs,
      en: bannerResourcesMobileEn,
      pt: bannerResourcesMobilePt,
      fr: bannerResourcesMobileFr,
    }
  },
  'service-team': {
    desktop: {
      es: bannerServiceTeamDesktopEs,
      en: bannerServiceTeamDesktopEn,
      pt: bannerServiceTeamDesktopPt,
      fr: bannerServiceTeamDesktopFr,
    },
    mobile: {
      es: bannerServiceTeamMobileEs,
      en: bannerServiceTeamMobileEn,
      pt: bannerServiceTeamMobilePt,
      fr: bannerServiceTeamMobileFr,
    }
  }
};

// Get the appropriate images
let mobileImage;
let desktopImage;
let secondDesktopImage = null;
let secondMobileImage = null;

if (isHomePage) {
  mobileImage = bannerImages.home.mobile;
  desktopImage = bannerImages.home.desktop;
  secondDesktopImage = bannerImages.home.invitation.desktop[locale as keyof typeof bannerImages.home.invitation.desktop];
  secondMobileImage = bannerImages.home.invitation.mobile[locale as keyof typeof bannerImages.home.invitation.mobile];
} else {
  const routeImages = bannerImages[routeName as keyof typeof bannerImages];
  if (routeImages && 'desktop' in routeImages && 'mobile' in routeImages) {
    mobileImage = routeImages.mobile[locale as keyof typeof routeImages.mobile];
    desktopImage = routeImages.desktop[locale as keyof typeof routeImages.desktop];
  } else {
    // Fallback to home images if route not found
    mobileImage = bannerImages.home.mobile;
    desktopImage = bannerImages.home.desktop;
  }
}

const logoImage = "/images/logo-jamcam-white.svg";
---

<section class="banner-container w-full relative overflow-hidden">
  {isHomePage ? (
    <!-- Carousel for home page -->
    <div 
      class="carousel-wrapper"
      id="home-carousel-wrapper"
    >
      <!-- First slide -->
      <div class="carousel-slide active">
        <picture class="banner-picture">
          <source
            media="(min-width: 1024px)"
            srcset={desktopImage.src}
            type="image/webp"
            width={desktopImage.width}
            height={desktopImage.height}
          />
          <Image 
            src={mobileImage}
            alt="Banner JamCam 2025"
            class="banner-image"
            loading="eager"
            fetchpriority="high"
            decoding="sync"
            width={mobileImage.width}
            height={mobileImage.height}
          />
        </picture>
      </div>
      
      <!-- Second slide -->
      {secondDesktopImage && secondMobileImage && (
        <div class="carousel-slide">
          <a href="/docs/jamcam-global-invitation-letter.pdf" target="_blank" rel="noopener noreferrer" class="banner-link">
            <picture class="banner-picture">
              <source
                media="(min-width: 1024px)"
                srcset={secondDesktopImage.src}
                type="image/webp"
                width={secondDesktopImage.width}
                height={secondDesktopImage.height}
              />
              <Image 
                src={secondMobileImage}
                alt="Banner JamCam 2025 - Boletín"
                class="banner-image"
                loading="eager"
                fetchpriority="high"
                decoding="sync"
                width={secondMobileImage.width}
                height={secondMobileImage.height}
              />
            </picture>
          </a>
        </div>
      )}
    </div>
  ) : (
    <!-- Single image for other pages -->
    <picture class="banner-picture">
      <source
        media="(min-width: 1024px)"
        srcset={desktopImage.src}
        type="image/webp"
        width={desktopImage.width}
        height={desktopImage.height}
      />
      <Image 
        src={mobileImage}
        alt="Banner JamCam 2025"
        class="banner-image"
        loading="eager"
        fetchpriority="high"
        decoding="sync"
        width={mobileImage.width}
        height={mobileImage.height}
      />
    </picture>
  )}

  <!-- Logo opcional centrado -->
  {showLogo && (
    <div class="logo-overlay" id={isHomePage ? "logo-overlay" : undefined}>
      <img 
        src={logoImage}
        alt="Logo JamCam 2025"
        class="logo-image"
        loading="eager"
        fetchpriority="high"
        decoding="sync"
        width="280"
        height="320"
      />
    </div>
  )}
</section>

<script define:vars={{ isHomePage, showLogo }}>
  if (isHomePage) {
    const initBannerCarousel = () => {
      const carouselWrapper = document.getElementById("home-carousel-wrapper");
      const logoOverlay = showLogo ? document.getElementById("logo-overlay") : null;

      if (!carouselWrapper) {
        return;
      }

      // Check if the carousel is already running to avoid multiple initializations
      if (carouselWrapper.dataset.carouselActive === "true") {
        return;
      }
      carouselWrapper.dataset.carouselActive = "true";

      const slides = carouselWrapper.querySelectorAll('.carousel-slide');
      if (slides.length < 2) {
        return;
      }

      let currentSlide = 0;

      setInterval(() => {
        const prevSlide = currentSlide;
        
        // Move to next slide
        currentSlide = (currentSlide + 1) % slides.length;
        
        // Reset all slides
        slides.forEach(slide => {
          slide.classList.remove('active', 'prev');
        });
        
        // Set current slide as active (slides in from right)
        slides[currentSlide].classList.add('active');
        
        // Set previous slide to slide out to the left
        slides[prevSlide].classList.add('prev');
        
        // Toggle logo visibility with smooth transition (show only on first slide)
        if (logoOverlay) {
          if (currentSlide === 0) {
            logoOverlay.classList.remove('hidden');
          } else {
            logoOverlay.classList.add('hidden');
          }
        }
      }, 6000);
    };

    // Use a simple timeout to ensure DOM is ready
    setTimeout(initBannerCarousel, 100);
    
    // Also listen for Astro page load events
    document.addEventListener("astro:page-load", () => {
      setTimeout(initBannerCarousel, 100);
    });
  }
</script>

<style>
  .carousel-wrapper {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .carousel-slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    transform: translateX(100%);
    transition: transform 0.6s ease-in-out;
  }

  .carousel-slide.active {
    transform: translateX(0);
  }

  .carousel-slide.prev {
    transform: translateX(-100%);
  }

  .carousel-slide:first-child {
    position: relative;
  }

  .banner-picture {
    width: 100%;
    display: block;
  }

  .banner-image {
    width: 100%;
    height: auto;
    display: block;
  }

  .banner-link {
    display: block;
    width: 100%;
    height: 100%;
    cursor: pointer;
    transition: opacity 0.2s ease-in-out;
  }

  .banner-link:hover {
    opacity: 0.95;
  }

  .logo-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    z-index: 10;
    padding-top: 20vh;
    pointer-events: none;
    opacity: 1;
    transition: opacity 0.4s ease-in-out;
  }

  .logo-overlay.hidden {
    opacity: 0;
  }

  .logo-image {
    height: 280px;
    width: auto;
    object-fit: contain;
  }

  @media (min-width: 1024px) {
    .logo-overlay {
      padding-top: 15vh;
    }

    .logo-image {
      height: 320px;
    }
  }
</style>