---
import { Image } from 'astro:assets';
import { getTranslations } from '../i18n';
import porQueColombiaImage from '../assets/images/news/Por qué Colombia es la sede ideal.jpg';
import historiaJamCamImage from '../assets/images/news/Historia del JamCam.jpg';
// @ts-expect-error - JPG extension in uppercase may cause TypeScript error but works at runtime
import jamcamLlegaColombiaImage from '../assets/images/news/JamCam 2025 llega a Colombia.JPG';
import caliHechaRecibirImage from '../assets/images/news/Cali hecha para recibir al mundo.jpg';
// @ts-expect-error - JPG extension in uppercase may cause TypeScript error but works at runtime
import staffEnAccionImage from '../assets/images/news/El staff ya está en acción.JPG';

interface Props {
  entry: any; // The full entry from getCollection
  locale: string;
}

const { entry, locale } = Astro.props;
const t = getTranslations(locale);

// Extract data from entry
const { title, category, publishDate, image, imageAlt } = entry.data;
const slug = entry.slug;

// Get category color based on category name
const getCategoryColor = (cat: string) => {
  const categories: Record<string, string> = {
    'Anuncio': 'bg-purple-jm',
    'Announcement': 'bg-purple-jm',
    'Anúncio': 'bg-purple-jm',
    'Annonce': 'bg-purple-jm',
    'Programa': 'bg-orange-jm',
    'Program': 'bg-orange-jm',
    'Programme': 'bg-orange-jm',
    'Actividades': 'bg-salmon-jm',
    'Activities': 'bg-salmon-jm',
    'Activités': 'bg-salmon-jm',
    'Atividades': 'bg-salmon-jm',
  };
  return categories[cat] || 'bg-pink-jm';
};

const categoryColor = getCategoryColor(category);

// Format date
const formatDate = (date: Date, locale: string) => {
  return new Intl.DateTimeFormat(locale, {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};

// Create localized URL
const getNewsUrl = () => {
  if (locale === 'es') {
    return `/news/${slug}`;
  }
  return `/${locale}/news/${slug}`;
};

// Handle image from src/assets or public
const getImageSrc = (imagePath: string) => {
  if (imagePath.startsWith('@news/')) {
    const imageMap: Record<string, any> = {
      '@news/Por qué Colombia es la sede ideal.jpg': porQueColombiaImage,
      '@news/Historia del JamCam.jpg': historiaJamCamImage,
      '@news/JamCam 2025 llega a Colombia.JPG': jamcamLlegaColombiaImage,
      '@news/Cali hecha para recibir al mundo.jpg': caliHechaRecibirImage,
      '@news/El staff ya está en acción.JPG': staffEnAccionImage,
    };
    return imageMap[imagePath] || imagePath;
  }
  return imagePath;
};

const imageSrc = getImageSrc(image);
const isImportedImage = typeof imageSrc !== 'string';
---

<article class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden group">
  <a href={getNewsUrl()} class="block">
    <!-- Image -->
    <div class="relative w-full aspect-video overflow-hidden">
      {isImportedImage ? (
        <Image 
          src={imageSrc}
          alt={imageAlt}
          class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
          loading="lazy"
          width={600}
          height={338}
        />
      ) : (
        <img 
          src={imageSrc}
          alt={imageAlt}
          class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
          loading="lazy"
        />
      )}
      <!-- Category Badge -->
      <div class={`absolute top-4 left-4 ${categoryColor} text-white px-4 py-2 rounded-full text-sm font-semibold shadow-md`}>
        {category}
      </div>
    </div>

    <!-- Content -->
    <div class="p-6">
      <!-- Date -->
      <p class="text-sm text-gray-500 mb-2">
        {formatDate(publishDate, locale)}
      </p>
      
      <!-- Title -->
      <h3 class="text-xl md:text-2xl font-bold text-gray-900 mb-4">
        {title}
      </h3>
      
      <!-- Read More Link -->
      <div class="flex items-center text-purple-jm font-semibold group-hover:text-salmon-jm transition-colors duration-300">
        <span>{t.news.readMore}</span>
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          class="h-5 w-5 ml-2 transition-transform duration-300 group-hover:translate-x-1" 
          fill="none" 
          viewBox="0 0 24 24" 
          stroke="currentColor"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </div>
    </div>
  </a>
</article>

