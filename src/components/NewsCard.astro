---
import { Image } from 'astro:assets';
import { getTranslations } from '../i18n';

// Dynamic image imports using glob
const images = import.meta.glob<{ default: ImageMetadata }>('../assets/images/news/**/*.{png,jpg,jpeg,PNG,JPG,JPEG}', { eager: true });

interface Props {
  entry: any; // The full entry from getCollection
  locale: string;
}

const { entry, locale } = Astro.props;
const t = getTranslations(locale);

// Extract data from entry
const { newsId, title, category, publishDate, imageAlt } = entry.data;
const slug = entry.slug;

// Get category color based on category name
const getCategoryColor = (cat: string) => {
  const categories: Record<string, string> = {
    // Información / Information / Informação
    'Información': 'bg-purple-jm',
    'Information': 'bg-purple-jm',
    'Informação': 'bg-purple-jm',
    // Preparación / Preparation / Préparation
    'Preparación': 'bg-orange-jm',
    'Preparation': 'bg-orange-jm',
    'Preparação': 'bg-orange-jm',
    'Préparation': 'bg-orange-jm',
    // Cultura y Música / Culture and Music / Culture et Musique
    'Cultura y Música': 'bg-pink-jm',
    'Culture and Music': 'bg-pink-jm',
    'Cultura e Música': 'bg-pink-jm',
    'Culture et Musique': 'bg-pink-jm',
    // Experiencia / Experience / Expérience
    'Experiencia': 'bg-salmon-jm',
    'Experience': 'bg-salmon-jm',
    'Experiência': 'bg-salmon-jm',
    'Expérience': 'bg-salmon-jm',
  };
  return categories[cat] || 'bg-purple-jm';
};

const categoryColor = getCategoryColor(category);

// Format date
const formatDate = (date: Date, locale: string) => {
  return new Intl.DateTimeFormat(locale, {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};

// Create localized URL
const getNewsUrl = () => {
  if (locale === 'es') {
    return `/news/${slug}`;
  }
  return `/${locale}/news/${slug}`;
};

// Get image sources dynamically using newsId
const getImageByNewsId = (newsId: string) => {
  const previewPath = `../assets/images/news/preview/${newsId}-preview.png`;
  const fullPath = `../assets/images/news/full/${newsId}-full.png`;
  
  const preview = images[previewPath]?.default;
  const full = images[fullPath]?.default;
  
  return { preview, full };
};

const { preview: previewSrc, full: fullSrc } = getImageByNewsId(newsId);
const isImportedImage = previewSrc !== undefined && fullSrc !== undefined;
---

<article class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden group">
  <a href={getNewsUrl()} class="block">
    <!-- Image Container with Preview/Full Toggle -->
    <div class="relative w-full aspect-video overflow-hidden">
      {isImportedImage && (
        <>
          <!-- Preview Image (visible by default) -->
          <Image 
            src={previewSrc}
            alt={imageAlt}
            class="news-image-preview w-full h-full object-cover transition-all duration-500 group-hover:scale-110"
            loading="lazy"
            width={600}
            height={338}
          />
          <!-- Full Image (visible on hover) -->
          <Image 
            src={fullSrc}
            alt={imageAlt}
            class="news-image-full absolute inset-0 w-full h-full object-cover transition-all duration-500 opacity-0 group-hover:opacity-100 group-hover:scale-110"
            loading="lazy"
            width={600}
            height={338}
          />
        </>
      )}
      <!-- Category Badge -->
      <div class={`absolute top-4 left-4 ${categoryColor} text-white px-4 py-2 rounded-full text-sm font-semibold shadow-md z-10`}>
        {category}
      </div>
    </div>

    <!-- Content -->
    <div class="p-6">
      <!-- Date -->
      <p class="text-sm text-gray-500 mb-2">
        {formatDate(publishDate, locale)}
      </p>
      
      <!-- Title -->
      <h3 class="text-xl md:text-2xl font-bold text-gray-900 mb-4">
        {title}
      </h3>
      
      <!-- Read More Link -->
      <div class="flex items-center text-purple-jm font-semibold group-hover:text-salmon-jm transition-colors duration-300">
        <span>{t.news.readMore}</span>
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          class="h-5 w-5 ml-2 transition-transform duration-300 group-hover:translate-x-1" 
          fill="none" 
          viewBox="0 0 24 24" 
          stroke="currentColor"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </div>
    </div>
  </a>
</article>

